# =======================================================================
# API Deployment Demo - Unified Environment Configuration
# =======================================================================
# Two environments in ONE file with clear prefixes:
#   STG_  = Staging (high ports, self-signed SSL)
#   PROD_ = Production (standard ports, real SSL)
#
# SETUP INSTRUCTIONS:
#   1. Copy this file: cp .env.example .env
#   2. Update passwords: Replace CHANGE_ME_* and REPLACE_WITH_* values
#   3. Run staging: make staging
#   4. Run production: make production (after updating PROD_ secrets)
#
# The system automatically selects the right section based on ENVIRONMENT.
# The Makefile and scripts/load-env-vars.sh handle the prefix stripping.
# =======================================================================

ENVIRONMENT=staging

# =======================================================================
# STAGING ENVIRONMENT
# =======================================================================

# --- Database ---
STG_DB_NAME=api_staging
STG_DB_USER=postgres
STG_DB_PASSWORD=CHANGE_ME_STAGING_PASSWORD
STG_DB_HOST=postgres
STG_DB_PORT=5432
STG_DB_HOST_AUTH_METHOD=md5
STG_DATABASE_URL=postgresql://postgres:CHANGE_ME_STAGING_PASSWORD@postgres:5432/api_staging
# checkov:skip=CKV_SECRET_4: Demo environment variable, not for production use

# --- API Application ---
STG_API_ENV=staging
STG_DEBUG=false
STG_SECRET_KEY=CHANGE_ME_STAGING_SECRET_KEY
STG_API_WORKERS=4
STG_LOG_LEVEL=info
STG_API_PORT=8000

# --- Ports (High Ports - No Conflicts with Production) ---
STG_HTTP_PORT=30080
STG_HTTPS_PORT=30443
STG_API_EXTERNAL_PORT=30800
STG_DB_EXTERNAL_PORT=35432

# --- Web Server ---
STG_SERVER_NAME=localhost
STG_API_UPSTREAM=api:8000

# --- SSL/TLS (Self-Signed) ---
STG_SSL_ENABLED=true
STG_SSL_SELF_SIGNED=true
STG_SSL_COUNTRY=US
STG_SSL_STATE=California
STG_SSL_CITY="Los Angeles"
STG_SSL_ORGANIZATION="API Demo Company - Staging"
STG_SSL_ORGANIZATIONAL_UNIT="IT Department"
STG_SSL_EMAIL=staging-admin@example.com
STG_SSL_DAYS_VALID=365
STG_SSL_KEY_SIZE=2048

# --- Docker Compose ---
STG_COMPOSE_PROJECT_NAME=api-deployment-demo-staging
STG_COMPOSE_HTTP_TIMEOUT=120

# --- Resource Limits ---
STG_API_MEMORY_LIMIT=512M
STG_API_CPU_LIMIT=0.5
STG_API_MEMORY_REQUEST=256M
STG_API_CPU_REQUEST=0.25
STG_NGINX_MEMORY_LIMIT=128M
STG_NGINX_CPU_LIMIT=0.25
STG_DB_MEMORY_LIMIT=512M
STG_DB_CPU_LIMIT=0.5

# --- Health Checks ---
STG_HEALTH_CHECK_RETRIES=5
STG_HEALTH_CHECK_TIMEOUT=30s
STG_HEALTH_CHECK_INTERVAL=30s
STG_HEALTH_CHECK_START_PERIOD=60s

# --- Security ---
STG_CORS_ALLOW_ORIGINS=http://localhost:30080,https://localhost:30443
STG_RATE_LIMIT_PER_MINUTE=100

# --- Monitoring ---
STG_MONITORING_ENABLED=true
STG_GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD
STG_PROMETHEUS_PORT=39090
STG_GRAFANA_PORT=33000

# --- Backup ---
STG_BACKUP_ENABLED=true
STG_BACKUP_RETENTION_DAYS=7
STG_BACKUP_SCHEDULE="0 2 * * *"


# =======================================================================
# PRODUCTION ENVIRONMENT
# =======================================================================

# --- Database ---
PROD_DB_NAME=api_production
PROD_DB_USER=postgres
PROD_DB_PASSWORD=REPLACE_WITH_PRODUCTION_PASSWORD
PROD_DB_HOST=postgres-service
PROD_DB_PORT=5432
PROD_DB_HOST_AUTH_METHOD=md5
PROD_DATABASE_URL=postgresql://postgres:REPLACE_WITH_PRODUCTION_PASSWORD@postgres-service:5432/api_production
# checkov:skip=CKV_SECRET_4: Demo environment variable, not for production use

# --- API Application ---
PROD_API_ENV=production
PROD_DEBUG=false
PROD_SECRET_KEY=REPLACE_WITH_PRODUCTION_SECRET_KEY
PROD_API_WORKERS=8
PROD_LOG_LEVEL=warning
PROD_API_PORT=8000

# --- Ports (Standard Ports) ---
PROD_HTTP_PORT=80
PROD_HTTPS_PORT=443
PROD_API_EXTERNAL_PORT=8000
PROD_DB_EXTERNAL_PORT=5432

# --- Web Server ---
PROD_SERVER_NAME=api.yourdomain.com
PROD_API_UPSTREAM=api-service.api-deployment-demo.svc.cluster.local:8000

# --- SSL/TLS (Real Certificates) ---
PROD_SSL_ENABLED=true
PROD_SSL_SELF_SIGNED=false
PROD_SSL_COUNTRY=US
PROD_SSL_STATE=California
PROD_SSL_CITY="Los Angeles"
PROD_SSL_ORGANIZATION="Your Company Name"
PROD_SSL_ORGANIZATIONAL_UNIT="IT Department"
PROD_SSL_EMAIL=ssl-admin@yourdomain.com
PROD_SSL_DAYS_VALID=365
PROD_SSL_KEY_SIZE=2048

# --- Docker/Container ---
PROD_COMPOSE_PROJECT_NAME=api-deployment-demo-production
PROD_COMPOSE_HTTP_TIMEOUT=180

# --- Resource Limits ---
PROD_API_MEMORY_LIMIT=1Gi
PROD_API_CPU_LIMIT=1000m
PROD_API_MEMORY_REQUEST=512Mi
PROD_API_CPU_REQUEST=500m
PROD_NGINX_MEMORY_LIMIT=256Mi
PROD_NGINX_CPU_LIMIT=500m
PROD_DB_MEMORY_LIMIT=2Gi
PROD_DB_CPU_LIMIT=2000m

# --- Health Checks ---
PROD_HEALTH_CHECK_RETRIES=3
PROD_HEALTH_CHECK_TIMEOUT=10s
PROD_HEALTH_CHECK_INTERVAL=15s
PROD_HEALTH_CHECK_START_PERIOD=60s

# --- Security ---
PROD_CORS_ALLOW_ORIGINS=https://yourdomain.com,https://api.yourdomain.com
PROD_RATE_LIMIT_PER_MINUTE=60

# --- Monitoring ---
PROD_MONITORING_ENABLED=true
PROD_GRAFANA_ADMIN_PASSWORD=REPLACE_WITH_PRODUCTION_GRAFANA_PASSWORD
PROD_PROMETHEUS_PORT=9090
PROD_GRAFANA_PORT=3000
PROD_PROMETHEUS_RETENTION=30d

# --- Kubernetes ---
PROD_K8S_NAMESPACE=api-deployment-demo
PROD_K8S_REPLICAS=3
PROD_HPA_MIN_REPLICAS=2
PROD_HPA_MAX_REPLICAS=10
PROD_HPA_CPU_TARGET=70
PROD_HPA_MEMORY_TARGET=80

# --- Backup ---
PROD_BACKUP_ENABLED=true
PROD_BACKUP_RETENTION_DAYS=30
PROD_BACKUP_SCHEDULE="0 2 * * *"

# --- Logging ---
PROD_LOG_FORMAT=json
PROD_LOG_OUTPUT=stdout
PROD_LOG_MAX_SIZE=100M
PROD_LOG_MAX_BACKUPS=10
