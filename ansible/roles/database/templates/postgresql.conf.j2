# PostgreSQL configuration file - Generated by Ansible
# {{ ansible_managed }}

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

listen_addresses = '{{ postgres_listen_addresses | join(',') }}'
port = {{ postgres_port }}
max_connections = {{ postgres_max_connections }}

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

shared_buffers = {{ postgres_shared_buffers }}
effective_cache_size = {{ postgres_effective_cache_size }}
work_mem = {{ postgres_work_mem }}
maintenance_work_mem = {{ postgres_maintenance_work_mem }}

#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

wal_level = replica
max_wal_size = 1GB
min_wal_size = 80MB

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

random_page_cost = 1.1
effective_io_concurrency = 200

#------------------------------------------------------------------------------
# ERROR REPORTING AND LOGGING
#------------------------------------------------------------------------------

log_destination = 'syslog'
logging_collector = off
log_connections = on
log_disconnections = on
log_lock_waits = on
log_statement = 'mod'
log_min_duration_statement = 1000

#------------------------------------------------------------------------------
# RUNTIME STATISTICS
#------------------------------------------------------------------------------

track_counts = on
track_functions = all
track_activity_query_size = 1024

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

default_text_search_config = 'pg_catalog.english'
timezone = 'UTC'
lc_messages = '{{ postgres_locale }}'
lc_monetary = '{{ postgres_locale }}'
lc_numeric = '{{ postgres_locale }}'
lc_time = '{{ postgres_locale }}'

#------------------------------------------------------------------------------
# LOCK MANAGEMENT
#------------------------------------------------------------------------------

deadlock_timeout = 1s

#------------------------------------------------------------------------------
# VERSION/PLATFORM COMPATIBILITY
#------------------------------------------------------------------------------

shared_preload_libraries = 'pg_stat_statements'

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS
#------------------------------------------------------------------------------

# Add custom configuration options here as needed