---
# Prometheus scrape targets for {{ inventory_hostname }}
# Generated by Ansible - {{ ansible_managed }}

- targets:
    - "{{ ansible_default_ipv4.address }}:9100"
  labels:
    job: "{{ prometheus_job_name | default('node') }}"
    instance: "{{ inventory_hostname }}"
    environment: "{{ environment | default('unknown') }}"
    server_role: "{{ server_role | default('unknown') }}"

{% if postgres_exporter_enabled | default(false) and ('db' in group_names or 'databases' in group_names) %}
- targets:
    - "{{ ansible_default_ipv4.address }}:9187"  
  labels:
    job: "postgres"
    instance: "{{ inventory_hostname }}"
    environment: "{{ environment | default('unknown') }}"
    database: "{{ vault_db_name }}"
{% endif %}